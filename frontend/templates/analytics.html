{% extends "base.html" %}

{% block title %}Analytics - HR Intelligence Platform{% endblock %}
{% block page_title %}Analytics & Insights{% endblock %}

{% block content %}
<div class="analytics-page">
    <!-- Filters Section -->
    <section class="filters-section">
        <div class="filter-group">
            <label for="date-range">Date Range</label>
            <input type="date" id="date-from" class="filter-input" onchange="updateAnalytics()">
            <span class="filter-separator">to</span>
            <input type="date" id="date-to" class="filter-input" onchange="updateAnalytics()">
        </div>

        <div class="filter-group">
            <label for="department-filter">Department</label>
            <select id="department-filter" class="filter-input" onchange="updateAnalytics()">
                <option value="">All Departments</option>
                <option value="engineering">Engineering</option>
                <option value="sales">Sales</option>
                <option value="hr">Human Resources</option>
                <option value="finance">Finance</option>
                <option value="operations">Operations</option>
            </select>
        </div>

        <button class="btn-secondary" onclick="exportAnalytics()">ðŸ“¥ Export CSV</button>
        <button class="btn-secondary" onclick="exportAnalyticsPDF()" style="margin-left:8px;">ðŸ“„ Export PDF</button>
    </section>

    <!-- Charts Grid -->
    <section class="charts-grid">
        <!-- Headcount by Department -->
        <div class="chart-wrapper">
            <h3 class="chart-title">Headcount by Department</h3>
            <canvas id="headcountChart" class="analytics-chart"></canvas>
        </div>

        <!-- Query Volume Trend (live from DB) -->
        <div class="chart-wrapper">
            <h3 class="chart-title">Query Volume Trend (Last 12 Months)</h3>
            <canvas id="queryVolumeChart" class="analytics-chart"></canvas>
        </div>

        <!-- Leave Utilization -->
        <div class="chart-wrapper">
            <h3 class="chart-title">Leave Days Used by Type</h3>
            <canvas id="leaveChart" class="analytics-chart"></canvas>
        </div>

        <!-- Agent Performance -->
        <div class="chart-wrapper">
            <h3 class="chart-title">Queries by Agent</h3>
            <canvas id="agentChart" class="analytics-chart"></canvas>
        </div>
    </section>

    <!-- Summary Statistics (populated dynamically from API) -->
    <section class="summary-stats-section">
        <h3 class="section-title">Key Metrics Summary</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <p class="stat-label">Total Headcount</p>
                <h3 class="stat-value" id="stat-headcount">â€“</h3>
                <p class="stat-change">Live from database</p>
            </div>

            <div class="stat-card">
                <p class="stat-label">Queries Today</p>
                <h3 class="stat-value" id="stat-queries-today">â€“</h3>
                <p class="stat-change">Live from query logs</p>
            </div>

            <div class="stat-card">
                <p class="stat-label">Avg Leave Days Used</p>
                <h3 class="stat-value" id="stat-avg-leave">â€“</h3>
                <p class="stat-change">Per employee average</p>
            </div>

            <div class="stat-card">
                <p class="stat-label">Avg Agent Confidence</p>
                <h3 class="stat-value" id="stat-avg-confidence">â€“</h3>
                <p class="stat-change">Across all queries</p>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="/static/js/analytics.js"></script>
{% endblock %}
